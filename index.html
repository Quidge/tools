<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dayviz - Daily Time Block Planner</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Google Sans', Roboto, Arial, sans-serif;
      background: #f8f9fa;
    }

    #app {
      max-width: 800px;
      margin: 0 auto;
      height: 100vh;
    }

    #timeline-container {
      display: flex;
      overflow-y: auto;
      height: 100vh;
      background: white;
      border-left: 1px solid #dadce0;
      border-right: 1px solid #dadce0;
      position: relative;
    }

    #hour-labels {
      width: 60px;
      flex-shrink: 0;
      position: relative;
      height: 1920px;
      background: #fafafa;
      border-right: 1px solid #e0e0e0;
      font-size: 11px;
      color: #70757a;
    }

    .hour-label {
      position: absolute;
      transform: translateY(-50%);
      text-align: right;
      padding-right: 8px;
      width: 100%;
    }

    #timeline {
      position: relative;
      flex: 1;
      height: 1920px;
    }

    #grid-lines {
      position: absolute;
      inset: 0;
    }

    .grid-line {
      position: absolute;
      width: 100%;
      border-top: 1px solid #e0e0e0;
    }

    #blocks-layer {
      position: absolute;
      inset: 0;
      left: 0;
      right: 8px;
    }

    .block {
      position: absolute;
      left: 4px;
      right: 4px;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      user-select: none;
      overflow: hidden;
      transition: box-shadow 0.15s ease;
      background: #4285F4;
      border-left: 4px solid #1a73e8;
      color: white;
      font-size: 13px;
      line-height: 1.3;
    }

    .block.focused {
      background: #1a73e8;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
      z-index: 10;
    }

    .block-content {
      display: flex;
      flex-direction: column;
      gap: 2px;
      overflow: hidden;
    }

    .block-name {
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .block-duration {
      font-size: 11px;
      opacity: 0.85;
    }

    .block-delete {
      position: absolute;
      top: 4px;
      right: 4px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 16px;
      line-height: 1;
      padding: 2px 4px;
      border-radius: 3px;
      opacity: 0;
      transition: opacity 0.1s;
    }

    .block:hover .block-delete {
      opacity: 0.7;
    }

    .block-delete:hover {
      opacity: 1;
      background: rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="timeline-container">
      <div id="hour-labels"></div>
      <div id="timeline">
        <div id="grid-lines"></div>
        <div id="blocks-layer"></div>
      </div>
    </div>
  </div>

  <script>
    // Constants
    const DAY_START = 0;
    const DAY_END = 1440;
    const SNAP = 5;
    const MIN_DURATION = 5;
    const DEFAULT_DURATION = 30;
    const HOUR_HEIGHT = 80;
    const MINUTE_HEIGHT = HOUR_HEIGHT / 60;

    // State
    const state = {
      blocks: [],
      focusedBlockId: null
    };

    // Helper functions
    function timeToY(minutes) {
      return minutes * MINUTE_HEIGHT;
    }

    function yToTime(y) {
      return snapToGrid(Math.max(DAY_START, Math.min(DAY_END, y / MINUTE_HEIGHT)));
    }

    function snapToGrid(minutes) {
      return Math.round(minutes / SNAP) * SNAP;
    }

    function formatTime(minutes) {
      const hours = Math.floor(minutes / 60);
      const mins = minutes % 60;
      return `${hours}:${mins.toString().padStart(2, '0')}`;
    }

    function formatDuration(minutes) {
      const hours = Math.floor(minutes / 60);
      const mins = minutes % 60;

      if (hours === 0) {
        return `${mins}m`;
      } else if (mins === 0) {
        return `${hours}h`;
      } else {
        return `${hours}h ${mins}m`;
      }
    }

    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
    }

    // Render blocks
    function renderBlocks() {
      const blocksLayer = document.getElementById('blocks-layer');
      const fragment = document.createDocumentFragment();

      state.blocks.forEach(block => {
        const blockEl = document.createElement('div');
        blockEl.className = 'block';
        if (block.id === state.focusedBlockId) {
          blockEl.classList.add('focused');
        }
        blockEl.dataset.blockId = block.id;

        const top = timeToY(block.startTime);
        const height = timeToY(block.endTime - block.startTime);
        blockEl.style.top = `${top}px`;
        blockEl.style.height = `${height}px`;

        const duration = block.endTime - block.startTime;
        blockEl.innerHTML = `
          <div class="block-content">
            <span class="block-name">${block.name}</span>
            <span class="block-duration">${formatDuration(duration)}</span>
          </div>
          <button class="block-delete" title="Delete block">&times;</button>
        `;

        fragment.appendChild(blockEl);
      });

      blocksLayer.replaceChildren(fragment);
    }

    // Initialize timeline
    function initTimeline() {
      const hourLabels = document.getElementById('hour-labels');
      const gridLines = document.getElementById('grid-lines');
      const timelineContainer = document.getElementById('timeline-container');

      // Generate hour labels (0-24)
      for (let hour = 0; hour <= 24; hour++) {
        const label = document.createElement('div');
        label.className = 'hour-label';
        label.style.top = `${hour * HOUR_HEIGHT}px`;
        label.textContent = `${hour}:00`;
        hourLabels.appendChild(label);
      }

      // Generate grid lines (0-24)
      for (let hour = 0; hour <= 24; hour++) {
        const line = document.createElement('div');
        line.className = 'grid-line';
        line.style.top = `${hour * HOUR_HEIGHT}px`;
        gridLines.appendChild(line);
      }

      // Add hardcoded test blocks
      state.blocks = [
        { id: 'test-1', name: 'Morning Routine', startTime: 360, endTime: 420 },
        { id: 'test-2', name: 'Deep Work', startTime: 540, endTime: 660 },
        { id: 'test-3', name: 'Lunch', startTime: 720, endTime: 780 }
      ];
      state.focusedBlockId = 'test-2';

      // Render blocks
      renderBlocks();

      // Scroll to ~5am area (300 minutes)
      timelineContainer.scrollTop = timeToY(300);
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', initTimeline);
  </script>
</body>
</html>
